{
	auto_https off
}

http://127.0.0.1:8080 {
	log {
		output stdout
		format console
	}
	
	encode zstd gzip

	# Preserve real client IP from Cloudflare
	request_header X-Real-IP {http.request.header.CF-Connecting-IP}
	request_header X-Forwarded-For {http.request.header.CF-Connecting-IP}
	request_header X-Forwarded-Proto {scheme}
	request_header Host {host}

	# MinIO console (subdomain)
	@minioConsole host minio.fibeger.com
	reverse_proxy @minioConsole minio:9001

	# MinIO S3 API under /minio on apex
	reverse_proxy /minio/* minio:9000 {
		uri strip_prefix /minio
	}

	# Default: Next.js app (catch-all)
	reverse_proxy app:3000
}
