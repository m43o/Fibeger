{
auto_https off
}

127.0.0.1:8080 {
encode zstd gzip

# Preserve real client IP from Cloudflare

header_up X-Real-IP {http.request.header.CF-Connecting-IP}
header_up X-Forwarded-For {http.request.header.CF-Connecting-IP}
header_up X-Forwarded-Proto {scheme}
header_up Host {host}

# MinIO console (subdomain)

@minioConsole host minio.fibeger.com
handle @minioConsole {
reverse_proxy minio:9001
}

# MinIO S3 API under /minio on apex

@minioAPI {
host fibeger.com
path /minio/\*
}
handle @minioAPI {
uri strip_prefix /minio
reverse_proxy minio:9000
}

# Default: Next.js app

@app host fibeger.com
handle @app {
reverse_proxy app:3000
}
}
